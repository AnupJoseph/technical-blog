<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[Explorations]]></title><description><![CDATA[Thoughts, stories, ideas and whatever other random thing came to my mind.]]></description><link>https://anup-blog.netlify.app/</link><image><url>https://anup-blog.netlify.app/favicon.png</url><title>Explorations</title><link>https://anup-blog.netlify.app/</link></image><generator>Ghost 4.16</generator><lastBuildDate>Sat, 23 Oct 2021 05:07:57 GMT</lastBuildDate><atom:link href="https://anup-blog.netlify.app/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Make a scatter plot with Svelte and D3]]></title><description><![CDATA[<blockquote>This blog is second in a series of (unofficial) course notes for the Data Visualization with React and D3 series by Curran Kelleher. Read the introductory blog post <a href="https://dev.to/learners/series-intro-data-visualization-with-svelte-and-d3-4c07">here</a>.</blockquote><p>The next chart in the series is a scatter plot based on the <a href="https://archive.ics.uci.edu/ml/datasets/iris">Iris Flowers Dataset</a>. I figured we could reuse</p>]]></description><link>https://anup-blog.netlify.app/make-a-scatter-plot-with-svelte-and-d3/</link><guid isPermaLink="false">61739751220c1814f0c9053f</guid><dc:creator><![CDATA[Anup Joseph]]></dc:creator><pubDate>Sat, 23 Oct 2021 05:06:23 GMT</pubDate><media:content url="https://anup-blog.netlify.app/content/images/2021/10/scatter-fixed.png" medium="image"/><content:encoded><![CDATA[<blockquote>This blog is second in a series of (unofficial) course notes for the Data Visualization with React and D3 series by Curran Kelleher. Read the introductory blog post <a href="https://dev.to/learners/series-intro-data-visualization-with-svelte-and-d3-4c07">here</a>.</blockquote><img src="https://anup-blog.netlify.app/content/images/2021/10/scatter-fixed.png" alt="Make a scatter plot with Svelte and D3"><p>The next chart in the series is a scatter plot based on the <a href="https://archive.ics.uci.edu/ml/datasets/iris">Iris Flowers Dataset</a>. I figured we could reuse a lot of the code from earlier examples than rewiriting everything from scratch. A properly cleaned version of the dataset by Curran is available <a href="https://gist.githubusercontent.com/curran/9e04ccfebeb84bcdc76c/raw/3d0667367fce04e8ca204117c290c42cece7fde0/iris.csv">here</a>.The dataset has four numerical columns namely <code>sepal_length,sepal_width,petal_length,petal_width</code> which we need to convert to numbers. Let&apos;s change the <code>row</code> and <code>onMount</code> functions to reflect this:<br></p><pre><code>const  row  =  function  (data)  {
    data.sepal_length  =  +data.sepal_length;
    data.sepal_width  =  +data.sepal_width;
    data.petal_length  =  +data.petal_length;
    data.petal_width  =  +data.petal_width;

    return data;
};

onMount(async  ()  =&gt; {

    dataset  =  await  csv(
&quot;https://gist.githubusercontent.com/curran/9e04ccfebeb84bcdc76c/raw/3d0667367fce04e8ca204117c290c42cece7fde0/iris.csv&quot;,
    row
    ).then((data)  =&gt; {
        return  data;
    });
});
</code></pre><blockquote>in case you are wondering where this code came from, look up this <a href="https://gist.github.com/AnupJoseph/efda2eed51802c5cd9ef21f3a9a0cee8">gist</a></blockquote><p>The <code>scaleBand</code> logic we used before doesn&apos;t make much sense in a scatter plot so we need to change that to <code>scaleLinear</code>. I am going to plot <code>petal_width</code> on X-axis and <code>petal_length</code> on Y-axis and so let&apos;s change the domain of <code>xScale</code> and <code>yScale</code> respectively. Again doesn&apos;t matter too much, so feel free to change the X and Y axes to your liking<br></p><pre><code>$: xScale  =  scaleLinear()
    .domain(extent(dataset, (d)  =&gt;  d.petal_width))
    .range([0, width]); 

$: yScale  =  scaleLinear()
    .domain(extent(dataset, (d)  =&gt;  d.petal_length))
    .range([0, height]);
</code></pre><p>To make the dots for the scatter plot we can make use of the <code>&lt;circle&gt;</code> SVG tag. in the plotting logic let&apos;s replace the <code>&lt;rect&gt;</code> tag by <code>circle</code> and specify its attributes appropriately.<br></p><pre><code>&lt;circle
    cx={xScale(data.petal_width)}
    cy={yScale(data.petal_length)}
    r=&quot;5&quot;
/&gt;
</code></pre><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--oEqRneUH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9mlldez3uzpzxiqksljo.png" class="kg-image" alt="Make a scatter plot with Svelte and D3" loading="lazy"></figure><p>Something you probably noticed here is that some dots appear to be cutoff from the SVG. The solution I can think of is to shift all the circles to the left. So I am going to wrap all the circles in a <code>&lt;g&gt;</code> apply the <code>transform</code> directive on it. Lets use the margins that we initialized way back before to translate it across:<br></p><pre><code>&lt;g  transform={`translate(${margin.left},${margin.right})`}&gt;
    {#each  dataset  as data, i}
        &lt;circle
        cx={xScale(data.petal_width)}
        cy={yScale(data.petal_length)}
        r=&quot;5&quot;
        /&gt;
    {/each}
&lt;/g&gt;
</code></pre><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--KMYNwSce--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mn4nfxghcljxk19rl5ul.png" class="kg-image" alt="Make a scatter plot with Svelte and D3" loading="lazy"></figure><p>I am also going to reconfigure the scales so that we have more space to work with at the bottom of the page and left.<br></p><pre><code>const  innerHeight  =  height  -  margin.top  -  margin.bottom,
innerWidth  =  width  -  margin.left  -  margin.right;

$: xScale  =  scaleLinear()
    .domain(extent(dataset, (d)  =&gt;  d.petal_width))
    .range([0, innerWidth]);

$: yScale  =  scaleLinear()
    .domain(extent(dataset, (d)  =&gt;  d.petal_length))
    .range([0, innerHeight]);
</code></pre><p>The Iris flowers in this dataset are of three different species. I think it makes sense to represent them with different colors. I am going to map an array of colors to the species using the <code>scaleOrdinal</code> function in D3.<br></p><pre><code>const classSet = new Set(dataset.map((d) =&gt; d.class));
$: colorScale = scaleOrdinal()
    .domain(classSet)
    .range([&quot;#003049&quot;, &quot;#d62828&quot;, &quot;#f77f00&quot;]);
</code></pre><p>And then change the <code>&lt;circle&gt;</code> element as follows:<br></p><pre><code>&lt;circle
    cx={xScale(data.petal_width)}
    cy={yScale(data.petal_length)}  
    r=&quot;5&quot;
    style={`fill:${colorScale(data.class)}`}
/&gt;
</code></pre><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--1uY8NmLG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fq4ej7ctgp9rc3dmsyrc.png" class="kg-image" alt="Make a scatter plot with Svelte and D3" loading="lazy"></figure><p>I think I&apos;ll make this a (slightly) more fully fleshed out chart and add labels and axes. First lets add x and y-axis labels. Labels are ofcourse just <code>&lt;text&gt;</code> elements.<br>We add the Y-axis label as follows:<br></p><pre><code>&lt;text  transform={`translate(${-25},${innerHeight  /  2}) rotate(-90)`}
&gt;Petal Length&lt;/text&gt;
</code></pre><p>That cryptic transform essentially just shifts to the left of all the circles and then rotate it. The Y-axis label is added as follows:<br></p><pre><code>&lt;text  x={innerWidth  /  2  }  y={innerHeight  +  30}&gt;Petal Width&lt;/text&gt;
</code></pre><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--nJAZFyOM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/kfamnx4ps3kcc5d7ez2w.png" class="kg-image" alt="Make a scatter plot with Svelte and D3" loading="lazy"></figure><p><br>Let&apos;s add an X-axis and Y-axis. We could write our own Axis component but I saw a nice reusable axis component that I quite liked <a href="https://github.com/TomFevrier/svelte-d3-demo/blob/master/src/Axis.svelte">here</a>. I am going to make a few changes there and use it.<br></p><pre><code>&lt;script&gt;

    import { select, selectAll } from  &quot;d3-selection&quot;;
    import { axisBottom, axisLeft } from  &quot;d3-axis&quot;;


    export let  innerHeight;
    export let  margin;
    export let  position;
    export let  scale;



    let  transform;
    let  g;

    $: {

        select(g).selectAll(&quot;*&quot;).remove();

        let  axis;
        switch (position) {
            case  &quot;bottom&quot;:
                axis  =  axisBottom(scale).tickSizeOuter(0);
                transform  =  `translate(0, ${innerHeight})`;
                break;

            case  &quot;left&quot;:

                axis  =  axisLeft(scale).tickSizeOuter(0);
                transform  =  `translate(${margin}, 0)`;
    }
    select(g).call(axis);
}
&lt;/script&gt;

&lt;g  class=&quot;axis&quot;  bind:this={g}  {transform} /&gt;
</code></pre><p>Finally lets import the axis component and add it in the <code>&lt;g&gt;</code> element like so:<br></p><pre><code>&lt;Axis  {innerHeight}  {margin}  scale={xScale}  position=&quot;bottom&quot; /&gt;
&lt;Axis  {innerHeight}  {margin}  scale={yScale}  position=&quot;left&quot; /&gt;
</code></pre><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--4h-90nFS--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/uq38prlrdadzvuu1huki.png" class="kg-image" alt="Make a scatter plot with Svelte and D3" loading="lazy"></figure><p>Yeah the Y-axis is inverted &#x1F62C;. Turns out I have doing this a bit wrong. For the record, I did wonder how such thin petals were so long. But then again what do I know about Iris flowers. Fixing this is easy enough. Let&apos;s change <code>yScale</code> as follows:<br></p><pre><code>$: yScale  =  scaleLinear()
    .domain(extent(dataset, (d)  =&gt;  d.petal_length))
    .range([innerHeight, 0]);
</code></pre><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--QYVBs6Uo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/e32ylc7fi6fblv0tzynv.png" class="kg-image" alt="Make a scatter plot with Svelte and D3" loading="lazy"></figure><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://gist.github.com/AnupJoseph/27a5f91d4a1ae6fae0b51cbe4394debd#file-axis-svelte"><div class="kg-bookmark-content"><div class="kg-bookmark-title">Scatter plot with D3 and Svelte</div><div class="kg-bookmark-description">Scatter plot with D3 and Svelte. GitHub Gist: instantly share code, notes, and snippets.</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://gist.github.com/fluidicon.png" alt="Make a scatter plot with Svelte and D3"><span class="kg-bookmark-author">Gist</span><span class="kg-bookmark-publisher">262588213843476</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://github.githubassets.com/images/modules/gists/gist-og-image.png" alt="Make a scatter plot with Svelte and D3"></div></a></figure><p>If you want a simple scatter plot then this is probably all you need. I actually went on to add some more (completely unecessary) styling to it. I wanted to see if for each species of the flower we could have different shaped-petals. Not Iris petals shapes of course but petals nonetheless.</p><p>So I gathered some petal shapes from a <a href="https://frontendmasters.com/courses/d3-js-react/">FrontendMasters</a> workshop by Shirley Wu <a href="https://observablehq.com/@sxywu/workshop-utility-functions#petalPaths">here</a>, modified them ever so slightly and saved as <code>paths.js</code><br></p><pre><code>export const  petalPaths  =  [
    &apos;M0 0 C5 5 5 10 0 10 C-5 10 -5 5 0 0&apos;,
    &apos;M-3.5 0 C-2.5 2.5 2.5 2.5 3.5 0 C5 2.5 2.5 7.5 0 10 C-2.5 7.5 -5.0 2.5 -3.5 0&apos;,
    &apos;M0 0 C5 2.5 5 7.5 0 10 C-5 7.5 -5 2.5 0 0&apos;
]
</code></pre><p>Let&apos;s import the <code>petalpaths</code> and map them to species using D3 <code>scaleOrdinal</code>.<br></p><pre><code>import { petalPaths } from  &quot;./paths&quot;;
$: shapeScale  =  scaleOrdinal().domain(classSet).range(petalPaths);
</code></pre><p>Finally instead of plotting circles, we plot a <code>&lt;path&gt;</code> element and set the d attribute to <code>shapeScale</code>.<br></p><pre><code>&lt;path
    d={shapeScale(data.class)}
    fill={`${colorScale(data.class)}`}
/&gt;
</code></pre><p>We wrap it in a <code>&lt;g&gt;</code> element and translate it to their respective position so that they dont overlap each other.<br></p><pre><code>&lt;g

    transform={`translate(${xScale(data.petal_width)},${
    yScale(data.petal_length)  -  5
    })`}
    &gt;
    &lt;path
    d={shapeScale(data.class)}
    fill={`${colorScale(data.class)}`}
    /&gt;
&lt;/g&gt;
</code></pre><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--s8qTLT0R--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4y8jnqfmd1nrd2itn353.png" class="kg-image" alt="Make a scatter plot with Svelte and D3" loading="lazy"></figure><p>I love this plot!<br>One thing to notice here however is that the plot does loose some accuracy on adding the shapes. So if that&apos;s an important concern then best stay away from it. Anyway, I think I&apos;ll end here.<br>Here&apos;s the full code -</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://gist.github.com/AnupJoseph/44057936917ead0fa565dc6fb1448138"><div class="kg-bookmark-content"><div class="kg-bookmark-title">App.svelte</div><div class="kg-bookmark-description">GitHub Gist: instantly share code, notes, and snippets.</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://gist.github.com/fluidicon.png" alt="Make a scatter plot with Svelte and D3"><span class="kg-bookmark-author">Gist</span><span class="kg-bookmark-publisher">262588213843476</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://github.githubassets.com/images/modules/gists/gist-og-image.png" alt="Make a scatter plot with Svelte and D3"></div></a></figure><p>So that&apos;s it for today. Have a nice day!</p>]]></content:encoded></item><item><title><![CDATA[Make a bar chart with D3 and Svelte]]></title><description><![CDATA[<blockquote>This blog is part of (unofficial) course notes for the <a href="https://www.youtube.com/watch?v=2LhoCfjm8R4">Data Visualization with React and D3</a> series by Curran Kelleher. Read the introductory blog post <a href="https://anupjoseph.hashnode.dev/series-intro-data-visualization-with-svelte-and-d3">here</a> .</blockquote><p>The first chart Curran explores is a simple horizontal bar chart. The data used for the chart is United Nations World Population Prospects data</p>]]></description><link>https://anup-blog.netlify.app/make-a-bar-chart-with-d3-and-svelte-2/</link><guid isPermaLink="false">61739496220c1814f0c904f3</guid><dc:creator><![CDATA[Anup Joseph]]></dc:creator><pubDate>Sat, 23 Oct 2021 05:00:33 GMT</pubDate><media:content url="https://anup-blog.netlify.app/content/images/2021/10/bar-chart-style.png" medium="image"/><content:encoded><![CDATA[<blockquote>This blog is part of (unofficial) course notes for the <a href="https://www.youtube.com/watch?v=2LhoCfjm8R4">Data Visualization with React and D3</a> series by Curran Kelleher. Read the introductory blog post <a href="https://anupjoseph.hashnode.dev/series-intro-data-visualization-with-svelte-and-d3">here</a> .</blockquote><img src="https://anup-blog.netlify.app/content/images/2021/10/bar-chart-style.png" alt="Make a bar chart with D3 and Svelte"><p>The first chart Curran explores is a simple horizontal bar chart. The data used for the chart is United Nations World Population Prospects data available <a href="https://population.un.org/wpp/Download/Standard/Population/">here on their website</a>. I am going to be using a (badly cleaned &#x1F62C;) slice of the <a href="https://raw.githubusercontent.com/AnupJoseph/svelteLearn/main/charts/bar-chart-svelte/public/data/population_data.csv">data</a> . In and itself, the data doesn&apos;t matter too much here. So long as it has atleast one value which we can plot as bars, any data should be useful without too much change.</p><p>To kick of the project, let first make a simple Svelte app. <a href="https://github.com/Rich-Harris/degit">Degit</a> package is a simple way to start building apps with Svelte. Feel free to replace <code>bar-chart</code> with any project name you want.</p><pre><code class="language-Shell">npx degit sveltejs/template bar-chart
cd bar-chart
npm install</code></pre><p>This will download a starter Svelte project, build out a folder structure and install the dependencies for Svelte. To use d3, we need to add d3 to our project:</p><pre><code>npm install d3
</code></pre><p>To run the Svelte app use</p><pre><code>npm run dev
</code></pre><p>I am going to make a folder called data and save the csv file there. To load data I are going to use the <code>csv</code> utility from d3.</p><pre><code class="language-HTML">&lt;script&gt;
  import { csv } from &quot;d3&quot;;
  import { onMount } from &quot;svelte&quot;;

  let dataset = [];
  onMount(async () =&gt; {
    dataset = await csv(&quot;data/population_data.csv&quot;).then((data) =&gt; {
      return data.slice(0, 10);
    });
  });
&lt;/script&gt;</code></pre><p>Okay there&apos;s more going on here than I promised. First off, I am going to take only a slice of 10 rows from the dataset, rather than taking everything. The <code>onMount</code> function is a lifecycle function from Svelte which runs when the component is first loaded. Now I don&apos;t think this is actually required here. Something like</p><pre><code>csv(&quot;data/population_data.csv&quot;, row).then((data) =&gt; {
    dataset = data.slice(0, 10);
  });
</code></pre><p>works just fine. <code>onMount</code> just looked like a convenient place to do the data loading work.</p><p>Now I am only going to plot the population for only the year 2020. So I am going to select that as a separate column. <a href="https://d3-wiki.readthedocs.io/zh_CN/master/CSV/">d3.csv</a> only provides the output as strings. We need to convert those into numbers. Fortunately the csv method has support for an accessor function which can be used to do the necessary preprocessing.</p><pre><code>const row = function (data) {
    data[&quot;Population&quot;] = +data[&quot;2020&quot;] * 1000;  // + here is the unary conversion operator
    return data;
  };
onMount(async () =&gt; {
    dataset = await csv(&quot;data/population_data.csv&quot;, row).then((data) =&gt; {
      return data.slice(0, 10);
    });
  });</code></pre><p>The population figures are in millions, so the multiply by thousand.<br>In D3 we generally use SVG to render our graphics. Let&apos;s define a height and a width for our SVG and provide it with a few margins as well.<br></p><pre><code>const margin = { top: 20, bottom: 20, left: 20, right: 20 };
const width = 840,
    height = 60
![bar-chart-middle.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1633758156708/v8jXQ1221.png)
;
</code></pre><p>And finally let&apos;s plot the svg.<br></p><pre><code>&lt;main&gt;
  &lt;svg {width} {height}&gt;&lt;/svg&gt;
&lt;/main&gt;
</code></pre><blockquote>In case you are wondering why we are not writing <code>width={width}</code> sort of syntax, then that&apos;s <a href="https://svelte.dev/tutorial/dynamic-attributes">Svelte&apos;s shorthand for attributes</a></blockquote><p>At the moment of course, there&apos;s nothing on the browser to see. Let&apos;s start changing that. Bar charts are essentially a bunch of rectangles arranged nicely. SVG has a <code>rect</code> block which can be used for this purpose. We need to create one reactangle for each element in our array.<br></p><pre><code>&lt;svg {width} {height}&gt;
    {#each dataset as data, i}
      &lt;rect width={width} height={10} /&gt;
    {/each}
  &lt;/svg&gt;
</code></pre><p>This is Svelte&apos;s <code>{#each}</code> block which is essentially a forEach which can render html. For now we&apos;ll ignore the height and width of the rect. This is what we get at the moment</p><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--SzwqGMBD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1633667643656/xZjtuVbpN.png" class="kg-image" alt="Make a bar chart with D3 and Svelte" loading="lazy"></figure><p>It might look like only one bar but the Element inspector will show that there are 10 of them overlapping each other. To shift the bars down and to resize the bars we need to use the concept of <a href="https://www.d3indepth.com/scales/">scales</a>. More specifically we need the <a href="https://github.com/d3/d3-scale#band-scales">scaleBand</a> and <a href="https://github.com/d3/d3-scale#linear-scales">scaleLinear</a> functions from d3.<br></p><pre><code>const yScale = scaleBand()
    .domain(dataset.map((d) =&gt; d[&quot;Location&quot;]))
    .range([0, height]);

const xScale = scaleLinear()
    .domain([0, max(dataset, (d) =&gt; d.Population)])
    .range([0, width]);
</code></pre><p>Let&apos;s now change the rect tag to reflect this updated scales.<br></p><pre><code>&lt;rect
        x={0}
        y={yScale(data.Location)}
        width={xScale(data.Population)}
        height={yScale.bandwidth()}
/&gt;
</code></pre><p>There we go. The browser reloads and .... it does not work!!! You refresh again hoping that maybe Svelte is a bit slow to update but the browser remains the same empty blank sheet it was 10 mins ago. In despair you turn to the inspector and it says nope width cannot be &quot;NaN&quot;.</p><p>This is a pretty surprising error as the code you wrote seems pretty reasonable. The thing I forgot here is that csv is being processed asynchronously. So when <code>xScale</code> and <code>yScale</code> are being processed they are working on empty arrays. The dataset array changes on the way and we need our <code>xScale</code> and <code>yScale</code> to react to that change. This seemed like a perfect case for using <a href="https://medium.com/geekculture/lets-talk-about-state-management-in-svelte-e4a59057b990">Svelte state</a> . Let&apos;s change the <code>const</code> to <code>$:</code>.<br></p><pre><code>$: yScale = scaleBand()
    .domain(dataset.map((d) =&gt; d[&quot;Location&quot;]))
    .range([0, height]);

$: xScale = scaleLinear()
   .domain([0, max(dataset, (d) =&gt; d.Population)])
   .range([0, width]);
</code></pre><p>And that works. There we have it. A perfectly horrible looking bar chart.</p><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--wqv6-6UR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1633758177181/kB24Losi1.png" class="kg-image" alt="Make a bar chart with D3 and Svelte" loading="lazy"></figure><p>Now while, I love the stark simplicity and gravity if this bar chart, I am being told that this is simply not enough for this to be a multi-million dollar NFT. Let&apos;s clean this up a bit, add some spacing between the bars and some color to the chart<br></p><pre><code>$: yScale = scaleBand()
    .domain(dataset.map((d) =&gt; d[&quot;Location&quot;]))
    .range([0, height])
    .paddingInner(0.15);
&lt;style&gt;
  rect {
    fill: #13293d;
  }
&lt;/style&gt;
</code></pre><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--lI1kpgQV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1633758977228/iFrejV35_Q.png" class="kg-image" alt="Make a bar chart with D3 and Svelte" loading="lazy"></figure><p>That is a bit better. Let&apos;s add some transitions because its so easy to do so in Svelte. grab the fly transition from Svelte.<br></p><pre><code>import { fly } from &quot;svelte/transition&quot;;
</code></pre><p>And modify the rect block as follows.<br></p><pre><code>{#each dataset as data, i}
      &lt;rect
        x={0}
        y={yScale(data.Location)}
        width={xScale(data.Population)}
        height={yScale.bandwidth()}
        in:fly={{ x: -200, duration: 1000, delay: i * 50 }}
      /&gt;
{/each}
</code></pre><figure class="kg-card kg-image-card"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--dlHhZSX1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://cdn.hashnode.com/res/hashnode/image/upload/v1633760004389/iMMArhsEb.gif" class="kg-image" alt="Make a bar chart with D3 and Svelte" loading="lazy"></figure><p>Here is the whole code for the graph.</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://gist.github.com/AnupJoseph/efda2eed51802c5cd9ef21f3a9a0cee8"><div class="kg-bookmark-content"><div class="kg-bookmark-title">bar-chart-with-transitions.svelte</div><div class="kg-bookmark-description">GitHub Gist: instantly share code, notes, and snippets.</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://gist.github.com/fluidicon.png" alt="Make a bar chart with D3 and Svelte"><span class="kg-bookmark-author">Gist</span><span class="kg-bookmark-publisher">262588213843476</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://github.githubassets.com/images/modules/gists/gist-og-image.png" alt="Make a bar chart with D3 and Svelte"></div></a></figure><p>That&apos;s all for today. Hope you had fun reading this!!</p><p>Thanks to <a href="https://twitter.com/currankelleher?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">Curran Kelleher</a> for creating this amazing <a href="https://www.youtube.com/watch?v=2LhoCfjm8R4">course</a></p><p>P.S. If you want a more complete example with title and axes and styling, look <a href="https://github.com/AnupJoseph/svelteLearn/tree/main/charts/bar-chart-svelte">here</a></p><p></p>]]></content:encoded></item><item><title><![CDATA[Series Intro: Data Visualization With Svelte and D3]]></title><description><![CDATA[<p>Curran Kelleher&apos;s <a href="https://www.youtube.com/watch?v=2LhoCfjm8R4">Data Visualization With React and D3 </a>is probably the most comprehensive course on D3 on the Internet. For some time I have been curious about <a href="https://d3js.org/">D3</a> and data visualization in general. While I have worked with Python libraries like <a href="https://matplotlib.org/">Matplotlib</a> , <a href="https://seaborn.pydata.org/">Seaborn</a> and <a href="https://plotly.com/">Plotly</a> and they are</p>]]></description><link>https://anup-blog.netlify.app/series-intro-data-visualization-with-svelte-and-d3/</link><guid isPermaLink="false">617390b1220c1814f0c904c6</guid><category><![CDATA[Svelte]]></category><category><![CDATA[Javascript]]></category><dc:creator><![CDATA[Anup Joseph]]></dc:creator><pubDate>Sat, 23 Oct 2021 04:37:01 GMT</pubDate><media:content url="https://anup-blog.netlify.app/content/images/2021/10/Series-logo.png" medium="image"/><content:encoded><![CDATA[<img src="https://anup-blog.netlify.app/content/images/2021/10/Series-logo.png" alt="Series Intro: Data Visualization With Svelte and D3"><p>Curran Kelleher&apos;s <a href="https://www.youtube.com/watch?v=2LhoCfjm8R4">Data Visualization With React and D3 </a>is probably the most comprehensive course on D3 on the Internet. For some time I have been curious about <a href="https://d3js.org/">D3</a> and data visualization in general. While I have worked with Python libraries like <a href="https://matplotlib.org/">Matplotlib</a> , <a href="https://seaborn.pydata.org/">Seaborn</a> and <a href="https://plotly.com/">Plotly</a> and they are fantastic for most kinds of exploratory and scientifc plots they have limitations on the web particularly in terms of interactivity. D3, for the uinitiated is the library which powers the bulk of all the interactive and SVG based plots on the web. It also acts as underlying low-level library for a lot of higher level libraries including Vega(For a more comprehensive list look <a href="https://github.com/wbkd/awesome-d3#charts">here</a> ).</p><p>In the series Curran uses D3 with React. However I personally find React impenetrable magic.</p><figure class="kg-card kg-image-card"><img src="https://anup-blog.netlify.app/content/images/2021/10/image-3.png" class="kg-image" alt="Series Intro: Data Visualization With Svelte and D3" loading="lazy" width="642" height="347" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/10/image-3.png 600w, https://anup-blog.netlify.app/content/images/2021/10/image-3.png 642w"></figure><p>Its also not very convenient to use with D3 as both access the DOM and accessing DOM directly in React is always a risky business. I found <a href="https://svelte.dev/">Svelte&apos;s </a>style of thinking really refreshing and intuitive. Svelte is a radical new approach to building user interfaces. Its essentially a compiler which takes <code>.svelte</code> files , which are components including HTML, CSS and JS required for the component to run and turns them into fast, lighweight code which can be executed in the browser.</p><p>So I am using Svelte instead of React for building the components. Also this series is not a tutorial on either D3 or Svelte. At best this can be thought of as course notes for my self to follow along with Curran&apos;s course. The only reason this is a series is because Hashnode allows to organize as series. As the series progress and more articles get added I&apos;ll add them to the end of this post.</p><p>P.S. I am not very good at either D3 and Svelte (Coming to think of it not very good at JS either &#x1F622;). The code will probably be full of errors, atrocious bad practices and horrible inefficiencies. Be kind enough to point out in the comments if you notice any such in a constructive manner.</p><p>That&apos;s all now. Hope you have a good day!</p><p></p>]]></content:encoded></item><item><title><![CDATA[Recreating a Bar Chart Design in Python]]></title><description><![CDATA[Learn to design a stylish bar chart in Python]]></description><link>https://anup-blog.netlify.app/recreating-a-bar-chart-design-in-python/</link><guid isPermaLink="false">6155468a2ec9c014bf83c68e</guid><category><![CDATA[Python]]></category><dc:creator><![CDATA[Anup Joseph]]></dc:creator><pubDate>Sun, 03 Oct 2021 13:22:38 GMT</pubDate><media:content url="https://anup-blog.netlify.app/content/images/2021/10/1_T5v47mcspkYIcfkrLu9GTw-1.png" medium="image"/><content:encoded><![CDATA[<img src="https://anup-blog.netlify.app/content/images/2021/10/1_T5v47mcspkYIcfkrLu9GTw-1.png" alt="Recreating a Bar Chart Design in Python"><p><em><em>Credits to </em></em><a href="https://www.linkedin.com/in/alenkagucek/" rel="noopener ugc nofollow"><em><em>Alenka Gucek</em></em></a><em><em> for her orginal design</em></em></p><hr><p>Recently, the Data visualization Stockholm(DVS) meetup group held their first datavis challenge. The dataset for the challenge was snow depth and temperature data from early 20th century to January 2021. The only design constraint was that the visualization had to be black and white.</p><figure class="kg-card kg-gallery-card kg-width-wide kg-card-hascaption"><div class="kg-gallery-container"><div class="kg-gallery-row"><div class="kg-gallery-image"><img src="https://anup-blog.netlify.app/content/images/2021/09/1_Z4z5TROLKSZ3byzMHSjpgQ.png" width="563" height="294" loading="lazy" alt="Recreating a Bar Chart Design in Python"></div><div class="kg-gallery-image"><img src="https://anup-blog.netlify.app/content/images/2021/09/1_MTReQUAp6a1Pe_RkP6Na1Q.png" width="700" height="1312" loading="lazy" alt="Recreating a Bar Chart Design in Python" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/09/1_MTReQUAp6a1Pe_RkP6Na1Q.png 600w, https://anup-blog.netlify.app/content/images/2021/09/1_MTReQUAp6a1Pe_RkP6Na1Q.png 700w"></div><div class="kg-gallery-image"><img src="https://anup-blog.netlify.app/content/images/2021/09/1_T5v47mcspkYIcfkrLu9GTw.png" width="1596" height="1204" loading="lazy" alt="Recreating a Bar Chart Design in Python" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/09/1_T5v47mcspkYIcfkrLu9GTw.png 600w, https://anup-blog.netlify.app/content/images/size/w1000/2021/09/1_T5v47mcspkYIcfkrLu9GTw.png 1000w, https://anup-blog.netlify.app/content/images/2021/09/1_T5v47mcspkYIcfkrLu9GTw.png 1596w" sizes="(min-width: 720px) 720px"></div></div><div class="kg-gallery-row"><div class="kg-gallery-image"><img src="https://anup-blog.netlify.app/content/images/2021/09/image-1.png" width="1509" height="952" loading="lazy" alt="Recreating a Bar Chart Design in Python" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/09/image-1.png 600w, https://anup-blog.netlify.app/content/images/size/w1000/2021/09/image-1.png 1000w, https://anup-blog.netlify.app/content/images/2021/09/image-1.png 1509w" sizes="(min-width: 720px) 720px"></div><div class="kg-gallery-image"><img src="https://anup-blog.netlify.app/content/images/2021/09/1_yJbTXrCMUSBaRpVVt0-ryw.jpeg" width="700" height="429" loading="lazy" alt="Recreating a Bar Chart Design in Python" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/09/1_yJbTXrCMUSBaRpVVt0-ryw.jpeg 600w, https://anup-blog.netlify.app/content/images/2021/09/1_yJbTXrCMUSBaRpVVt0-ryw.jpeg 700w"></div></div></div><figcaption>Submissions in the Stockholm contest</figcaption></figure><p>The challenge received an amazing variety of great submissions. You can read more about them <a href="https://medium.com/data-visualization-stockholm/data-viz-challenge-1-a288142e8006" rel="noopener">here</a>.</p><p>All of these designs are frankly magnificent. However one design among these stood out to me for its simplicity and elegance. This design was made by <a href="https://twitter.com/alenka_gucek" rel="noopener ugc nofollow">Alenka Gucek</a>, a postdoc researcher at Uppsala university</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://anup-blog.netlify.app/content/images/2021/09/image-2.png" class="kg-image" alt="Recreating a Bar Chart Design in Python" loading="lazy" width="1509" height="952" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/09/image-2.png 600w, https://anup-blog.netlify.app/content/images/size/w1000/2021/09/image-2.png 1000w, https://anup-blog.netlify.app/content/images/2021/09/image-2.png 1509w" sizes="(min-width: 720px) 720px"><figcaption>Alenka Gucek&#x2019;s design</figcaption></figure><p>I felt that the most important part of this design is its focus on minimalism and its reusability. This design and its variations in color can be used in a variety of places, essentially wherever bar charts are used. It conveys the information accurately and is interesting and visually pleasing at the same time. Keeping this in mind, I decided to recreate this design as closely as possible. I have tried to make this chart as &#x201C;templatey&#x201D; as possible.</p><p>The original design was done in the far fortresses of Excel, Orgin and CorelDraw. I had little to zero knowledge of these tools and so I decided to recreate this plot in Python using the Plotly library.</p><figure class="kg-card kg-gallery-card kg-width-wide"><div class="kg-gallery-container"><div class="kg-gallery-row"><div class="kg-gallery-image"><img src="https://anup-blog.netlify.app/content/images/2021/09/image-3.png" width="663" height="453" loading="lazy" alt="Recreating a Bar Chart Design in Python" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/09/image-3.png 600w, https://anup-blog.netlify.app/content/images/2021/09/image-3.png 663w"></div><div class="kg-gallery-image"><img src="https://anup-blog.netlify.app/content/images/2021/09/image-4.png" width="663" height="453" loading="lazy" alt="Recreating a Bar Chart Design in Python" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/09/image-4.png 600w, https://anup-blog.netlify.app/content/images/2021/09/image-4.png 663w"></div><div class="kg-gallery-image"><img src="https://anup-blog.netlify.app/content/images/2021/09/image-5.png" width="663" height="453" loading="lazy" alt="Recreating a Bar Chart Design in Python" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/09/image-5.png 600w, https://anup-blog.netlify.app/content/images/2021/09/image-5.png 663w"></div></div></div></figure><p>Now the de facto library for creating visualizations with python is matplotlib. However, I personally find matplotlib a bit unrewarding and kind of overwhelming, so I prefer to use plotly. It has built in interactivity and the overall visual as well as developer experience is great. While not as powerful as matplotlib, its quite good and its almost too easy to get started.</p><p>Here the link to the google colaboratory interactive Jupyter environment and this is the link to the <a href="https://github.com/AnupJoseph/plotly_bar_chart" rel="noopener ugc nofollow">github repo</a>.</p><p></p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://colab.research.google.com/drive/1_DcUOargym-RBgLQfXN0NjXOOCrJa_mT?usp=sharing"><div class="kg-bookmark-content"><div class="kg-bookmark-title">Google Colaboratory</div><div class="kg-bookmark-description"></div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://colab.research.google.com/img/favicon.ico?vrz=colab-20210928-060101-RC00_399406659" alt="Recreating a Bar Chart Design in Python"></div></div><div class="kg-bookmark-thumbnail"><img src="https://colab.research.google.com/img/colab_favicon_256px.png" alt="Recreating a Bar Chart Design in Python"></div></a></figure><p>To get started lets import the python data science essential libraries, numpy and pandas.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/d8d09a2e2cd29d5483d3a978436ed62c.js"></script><!--kg-card-end: html--><p>I have also added the datetime libraries and of course, plotly itself.</p><p>The dataset for the challenge can be found in <a href="https://github.com/Dataviz-Stockholm/challenges" rel="noopener ugc nofollow">this repository</a>. Lets import the data and have a look at it. Since by looking at the data on github we already know that the dataset has a time column, I am adding a parse_dates arguement.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/588b60a7e058ab7cb26e6d6c961af0a6.js"></script><!--kg-card-end: html--><p>Running a unique check we find that there are some bad values in the dataset which need to be cleaned up.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/146fa3dc644184edc299a11d0c7a373b.js"></script><!--kg-card-end: html--><p>Now admittedly since we are interested in the maximum value of the Snow depth the deviations like &#x201C;-00.02.00&#x201D; won&#x2019;t matter much and simply dropping them won&#x2019;t cause a lot of trouble. But that&#x2019;s not really a good practice.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/e9cf630bf142d009cd038eaf33fb9a83.js"></script><!--kg-card-end: html--><p>Next, let&#x2019;s convert the &#x201C;Snow&#x201D; column into floats. Since we are interested in the yearly maximum snow depth lets group the dataset in years and find out the maximum snow depth in each year.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/bb97cb277370b93b52f896ab45b7bcca.js"></script><!--kg-card-end: html--><p>This is the data we need to plot. Now plotly has a system of traces for plotting. Each individual trace is a small component like a<a href="https://plotly.com/python/line-and-scatter/" rel="noopener ugc nofollow"> scatter of points</a> or a <a href="https://plotly.com/python/bar-charts/" rel="noopener ugc nofollow">bar</a>. These components are collectively available under plotly.<a href="https://plotly.com/python/graph-objects/" rel="noopener ugc nofollow">graph_objects</a> and can be combined to create interactive and useful charts.</p><hr><p>My first plan was to use bar charts to make this visualization, specifically the go.Bar class and somehow make the adjacent lines of the bar chart disappear. I quickly realized that this was a terrible plan and plotly doesn&#x2019;t even allow this to be done. My second idea was to create a scatterplot and join them using lines. This is kind of counter-intuitive and takes a second to wrap your head around it. Imagine it like this,</p><ul><li>A scatterplot has collection of points representing datapoints.</li><li>Now instead of having points, turn each point into small line with a small length.</li><li>Seperate each point by the given length.</li><li>Then join them all together vertically to give an impression of bars.</li></ul><p>Now to make any scatterplot we need two dimensions x and y. We will build y co-ordinates first and then create the corresponding x co-ordinates.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/6d0f8929da70d38c174c854017fa340d.js"></script><!--kg-card-end: html--><p>Since, this is a scatterplot pretending to be a bar chart we need to have two values of each maximum snow depth (Remember the dots getting width thing I rattled off before?). Next we use these y co-ordinates to build our x co-ordinates. I have chosen a width of 5 for each bars but feel free to choose any other.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/fa9e9dc1c3e3c4dfc0781a4ac198304f.js"></script><!--kg-card-end: html--><p>Finally our long setup process it done. Lets get started on plotting. We will add one trace of scatterplots with our x and y co-ordinates and set the mode to lines. Plotly will then join each co-ordinate for us. Keeping the in the black and white theme of the challenge lets make the line white and the background dark.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/0e048fd75498e45ed20f6e7aeec76372.js"></script><!--kg-card-end: html--><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://anup-blog.netlify.app/content/images/2021/10/image.png" class="kg-image" alt="Recreating a Bar Chart Design in Python" loading="lazy" width="700" height="295" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/10/image.png 600w, https://anup-blog.netlify.app/content/images/2021/10/image.png 700w"><figcaption>basic plot</figcaption></figure><p>This is what our plot looks like at the moment. We are already quite a long way there. For now lets add a title to the plot and remove the grid and axes.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/1d1d832c745433aa652b5c490887593d.js"></script><!--kg-card-end: html--><figure class="kg-card kg-image-card"><img src="https://anup-blog.netlify.app/content/images/2021/10/image-1.png" class="kg-image" alt="Recreating a Bar Chart Design in Python" loading="lazy" width="700" height="295" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/10/image-1.png 600w, https://anup-blog.netlify.app/content/images/2021/10/image-1.png 700w"></figure><p>The last additions to our plots are the xaxis and yaxis labels. Here plotly&#x2019;s interactive components come into play.</p><ul><li>Choose the years you want to annotate.</li><li>Find the snow_depth at those years. The snow_max variable will help in this.</li><li>Hover over the graph and find out the snow_depth of your chosen years. Note the corresponding xaxis values in the tooltip.</li><li>Pass these xaxis values to your tickvals variable</li></ul><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/fe017b9fa9743d37a4e38c1de9e8f0ed.js"></script><!--kg-card-end: html--><figure class="kg-card kg-image-card"><img src="https://anup-blog.netlify.app/content/images/2021/10/image-2.png" class="kg-image" alt="Recreating a Bar Chart Design in Python" loading="lazy" width="700" height="295" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/10/image-2.png 600w, https://anup-blog.netlify.app/content/images/2021/10/image-2.png 700w"></figure><p>We need to fix up the tooltip in the graph. At the moment it shows the actual X and Y axis values of the graph on the tooltip. To change that we need to create a array of values we want to display. For every even index in the x_axis let&#x2019;s add the corresponding years twice.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/71f6382f9eb165b3f0cde694ae8d3458.js"></script><!--kg-card-end: html--><p>The last things left on the plot are annotations. I am deliberately not annotating everything in the plot. However I&#x2019;ll add an example here.</p><!--kg-card-begin: html--><script src="https://gist.github.com/AnupJoseph/cfa57f7ea867ad33716673accf9bc43d.js"></script><!--kg-card-end: html--><p>Here&#x2019;s the final interactive version of the plot.</p><p>So that&#x2019;s all for today. Hope you had as much fun reading the tutorial as I had writing it.</p><p>Thanks to <a href="https://medium.com/@sam99dave" rel="noopener">Samuel Davis</a> and <a href="https://www.linkedin.com/in/darlene-nazareth-b08bb9192/" rel="noopener ugc nofollow">Darlene Nazerath</a> for helping with reviewing the the article and testing the code.<br>Feel free to connect with me on <a href="https://www.linkedin.com/in/anup-joseph/" rel="noopener ugc nofollow">LinkedIn</a>.</p><p></p><p></p><p><br></p><p></p><p></p><p></p><p></p><p></p>]]></content:encoded></item><item><title><![CDATA[Opening Resnets]]></title><description><![CDATA[<p><strong><em>Step by step exploration on what happens to an image in Resnets</em></strong></p><p>Residual Networks(Resnets from here on) were introduced by Kaiming He, Xiangyu Zhang, Shaoqing Ren and Jian Sun of Microsoft Research in their seminal paper - <a href="https://arxiv.org/pdf/1512.03385.pdf">Deep Residual Learning for Image Recognition</a>. Resnets effectively solves the vanishing gradient</p>]]></description><link>https://anup-blog.netlify.app/unlocking-resnets/</link><guid isPermaLink="false">614410e54298b8193f10a668</guid><category><![CDATA[Deep Learning]]></category><dc:creator><![CDATA[Anup Joseph]]></dc:creator><pubDate>Thu, 30 Sep 2021 05:26:00 GMT</pubDate><media:content url="https://anup-blog.netlify.app/content/images/2021/09/resnet.png" medium="image"/><content:encoded><![CDATA[<img src="https://anup-blog.netlify.app/content/images/2021/09/resnet.png" alt="Opening Resnets"><p><strong><em>Step by step exploration on what happens to an image in Resnets</em></strong></p><p>Residual Networks(Resnets from here on) were introduced by Kaiming He, Xiangyu Zhang, Shaoqing Ren and Jian Sun of Microsoft Research in their seminal paper - <a href="https://arxiv.org/pdf/1512.03385.pdf">Deep Residual Learning for Image Recognition</a>. Resnets effectively solves the vanishing gradient problem for deep networks and the ideas they introduced have been used in multiple architectures from there on. </p><p>In a recent assignment I was tasked with understanding how Resnets worked and present the same. I was curious to know what actually happened to an image in Resnet and tried to work out the same. This blog post is the result of that experiment and tries to illustrate the various calculations that happen inside the Resnet architecture.</p><p><em>Before we begin, I am almost certain that this article will have mistakes. I have tried my best to eliminate them. However if you do find any mistake please let me know in the comment or mail personally <a href="mailto:anup20joseph@gmail.com">here</a> and I will fix them as soon as possible.</em></p><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="https://anup-blog.netlify.app/content/images/2021/09/network.png" class="kg-image" alt="Opening Resnets" loading="lazy" width="614" height="276" srcset="https://anup-blog.netlify.app/content/images/size/w600/2021/09/network.png 600w, https://anup-blog.netlify.app/content/images/2021/09/network.png 614w"><figcaption>Resnet architectures</figcaption></figure><p>The Resnet paper, &#xA0;quite helpfully provides this diagram dividing the network into blocks and showing the output sizes of each block. However this picture might give idea that stride is common through the network from block 2 to 5, which is not the case. We also need to look at the Resnet 34 network given in the paper.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://anup-blog.netlify.app/content/images/2021/09/Architecture-Resnet-34.png" class="kg-image" alt="Opening Resnets" loading="lazy" width="86" height="539"><figcaption>Resnet 34 architecture with residual connections</figcaption></figure><p>This image adds crucial information about strides missing in the earlier image. However this does not have the concise block structures of the earlier image, so I suggest to keep them both at hand. There is one more important bit of information useful in computing the image size. The paper expresses this as </p><p><em>we use identity mapping for all shortcuts and zero-padding for increasing dimensions.</em></p><p>However, I feel that this bit of Python in the (old)Tensorflow implementation of Resnet is a bit more helpful.</p><pre><code class="language-python">padding=(&apos;SAME&apos; if strides == 1 else &apos;VALID&apos;)</code></pre><p>This acts as a nice rule for computing through the architecture after block 1 without having to think it through every time. For people wondering what is <em>padding=&quot;SAME&quot; </em>and <em>padding=&quot;VALID&quot; </em>try this <a href="https://stackoverflow.com/questions/37674306/what-is-the-difference-between-same-and-valid-padding-in-tf-nn-max-pool-of-t">link</a>. Armed with all that info, lets get to work.</p><p>Input image size - (224,224,3)</p><h3 id="block-1-conv1">Block 1: conv1</h3><p>Layer 1: Convolution(filters=64, kernel_size=7x7, strides=2)</p><p>To calculate the output size in a convolution layer we use this formula:</p><!--kg-card-begin: html--><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 542 80" width="542" height="80">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style>
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
  </defs>
  <rect x="0" y="0" width="542" height="80" fill="#ffffff"/><g transform="translate(10 20) rotate(0 76.5 12.5)"><text x="0" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">output_size = </text></g><g transform="translate(171 10) rotate(0 155 12.5)"><text x="0" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">input - kernel_size + 2*padding</text></g><g stroke-linecap="round"><g transform="translate(167 35) rotate(0 158.86764805005396 0.6714253277797297)"><path d="M-0.1 0.54 C53.29 0.71, 266.12 0.33, 319.35 0.37 M-1.61 -0.23 C51.73 0.16, 265.21 1.21, 318.58 1.57" stroke="#000000" stroke-width="1" fill="none"/></g></g><g transform="translate(504 24) rotate(0 14 12.5)"><text x="0" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">+ 1</text></g><g transform="translate(318 45) rotate(0 28.5 12.5)"><text x="0" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">stride</text></g></svg><!--kg-card-end: html--><p>For the first input the above rule does not apply instead the padding is 2.</p><p>Output size = (224 - 7 + 2 * 2) / 2 + 1 = 111.5 &#x2248; 112.															</p><p>Final output size of this block = (112x112x64)</p><h3 id="block-2-conv2x">Block 2: conv2_x</h3><p>Layer 1: Maxpool(kernel_size=3x3, strides=2)</p><p>To calculate the output size in a maxpool layer we use this formula</p><!--kg-card-begin: html--><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 407 80" width="407" height="80">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style>
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
  </defs>
  <rect x="0" y="0" width="407" height="80" fill="#ffffff"/><g transform="translate(10 20) rotate(0 76.5 12.5)"><text x="0" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">output_size = </text></g><g transform="translate(171 10) rotate(0 91.5 12.5)"><text x="0" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">input - kernel_size</text></g><g stroke-linecap="round"><g transform="translate(167 35) rotate(0 96.54208162748716 0.4570427794335501)"><path d="M-0.1 0.54 C32.51 0.64, 162.25 -0.03, 194.7 -0.06 M-1.61 -0.23 C30.96 0.08, 161.33 0.85, 193.93 1.14" stroke="#000000" stroke-width="1" fill="none"/></g></g><g transform="translate(369 24) rotate(0 14 12.5)"><text x="0" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">+ 1</text></g><g transform="translate(218 45) rotate(0 28.5 12.5)"><text x="0" y="18" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#000000" text-anchor="start" style="white-space: pre;" direction="ltr">stride</text></g></svg><!--kg-card-end: html--><p>Output size = (112 - 3) / 2+ 1 = 56																				</p><p>Output size = (56x56x64)</p><p>Layer 2: Convolution(filters=64, kernel_size=3x3, strides=1)</p><p>Output size = (56 - 3 + 2 x 1 ) / 1 + 1 = 55.5 &#x2248; 56</p><p>Output size = (56x6x64)</p><p>There are 5 more Convolution(filters=64, kernel_size=3x3, strides=1) layers. As you can see from the above calculation this does not downsample the image and hence the output size remains the size. Hence the output from this block is (56x56x64).</p><h3 id="block-3-conv3x">Block 3: conv3_x</h3><p>Layer 1: Convolution(filters=128, kernel_size=3x3, strides=2)</p><p>Output size = (56 - 3 + 2 x 0) / 2 + 1 = 27.5 &#x2248; 28</p><p>Output size = (28x28x128)</p><p>Layer 2: Convolution(filters=128, kernel_size=3x3, strides=1)</p><p>Output size = (28 - 3 + 2 x 1) / 1 + 1 = 28</p><p>Output size = (28x28x128)</p><p>There are 6 more Convolution(filters=128, kernel_size=3x3, strides=1) layers. Again this does not downsample the image and hence the output size remains the size. Hence the output from this block is (28x28x128).</p><h3 id="block-4-conv4x">Block 4: conv4_x</h3><p>Layer 1: Convolution(filters=256, kernel_size=3x3, strides=2)</p><p>Output size = (28 - 3 + 2 x 0) / 2 + 1 = 13.5 &#x2248; 14</p><p>Output size = (14x14x256)</p><p>Layer 2: Convolution(filters=256, kernel_size=3x3, strides=1)</p><p>Output size = (14 - 3 + 2 x 1) / 1 + 1 = 14</p><p>Output size = (14x14x256)</p><p>There are 10 more Convolution(filters=256, kernel_size=3x3, strides=1) layers. And like above the output size remains the same. So final output size = (14x14x256).</p><h3 id="block-5-conv5x">Block 5: conv5_x</h3><p>Layer 1: Convolution(filters=512, kernel_size=3x3, strides=2)</p><p>Output size = (14 - 3 + 2 x 0) / 2 + 1 = 6.5 &#x2248; 7</p><p>Output size = (7x7x512)</p><p>Layer 2: Convolution(filters=512, kernel_size=3x3, strides=1)</p><p>Output size = (7 - 3 + 2x1)/1 +1 = 7</p><p>Output size = (7x7x512)</p><p>There are 4 more Convolution(filters=512, kernel_size=3x3, strides=1) layers. And like above the output size remains the same. So final output size = (7x7x512).</p><h3 id="block-5-conv5x-1">Block 5: conv5_x</h3><p>Global average pool is essentially a large classifier which converts the 7x7x512 layer into 1x1x1000 as the Resnet is trained on the ImageNet dataset which has a thousand classes.</p><!--kg-card-begin: html--><script src="https://utteranc.es/client.js" repo="[ENTER REPO HERE]" issue-term="pathname" label="blog-question" theme="dark-blue" crossorigin="anonymous" async>
</script><!--kg-card-end: html-->]]></content:encoded></item></channel></rss>